<!doctype html>
<html>
<body>
<div id="write" class=""><header>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"></header><!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"><!-- Latest compiled and minified JavaScript --><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><p></p><!-- include:Logo --><style type="text/css">
  body {
      font-family:  "Roboto", "Helvetica", sans-serif;
      font-size: 12pt;
      line-height: 1.6;
      margin: 50px;
      background-color: black;
      color: white;
  }
  p {
      list-style-position: inside;
  }
  #ssb_blue {
    background-color: #257ACF;
    font-weight: bold;
    font-size: 90%;
    color: white;
    border-radius: 5px;
    padding-top: 3px;
    padding-bottom: 3px;
    padding-left: 10px;
    padding-right: 10px;
    white-space: nowrap;
  }
  #ssb_voc_grey {
    background-color: #F2F3F4;
    font-weight: normal;
    font-size: 90%;
    color: black;
    border-radius: 3px;
    border: 1px solid gray;
    padding-top: 5px;
    padding-bottom: 5px;
    padding-left: 6px;
    padding-right: 6px;
    white-space: nowrap;
  }
  #ssb_grey {
    background-color: #DEDEDE;
    font-weight: bold;
    font-size: 90%;
    color: #444;
    position: relative;
    top:-1px;
    border-radius: 5px;
    border-width: 1px;
    border-style: solid;
    border-color: #444;
    padding-top: 3px;
    padding-bottom: 3px;
    padding-left: 10px;
    padding-right: 10px;
    white-space: nowrap;
  }
  #ssl_alexa_ocean {
    color: #00a0d2;
    font-weight: bold;
  }
 #ssb_services {
    background-color:#232f3e;
    font-weight:bold;
    font-size:90%;
    color:white;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
  }
  #ssb_orange {
    background-color:#ec7211;
    font-weight:bold;
    font-size:90%;
    color:white;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
    white-space:
    nowrap;
  }
  #ssbox_cloudformation_blue {
    font-weight:bold;
    background-color:#f1faff;
    font-size:90%;
    border-color:#00A1C9;
    border-width:1px;
    border-style:solid;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
  }
  #ssb_ssm_white {
    background-color:white;
    font-weight:bold;
    font-size:90%;
    color:#545b64;
    border-color:#545b64;
    border-radius:2px;
    border-width:1px;
    border-style:solid;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
  }
  #ssb_s3_blue {
    background-color:#329AD6;
    font-weight:bold;
    font-size:90%;
    color:white;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
  }
  #ssb_s3_white {
    background-color:white;
    font-weight:bold;
    font-size:90%;
    color:#329AD6;
    border-color:#329AD6;
    border-width:1px;
    border-style:solid;
    padding-top:3px;
    padding-bottom:3px;
    padding-left:10px;
    padding-right:10px;
  }
</style><!-- include:Logo --><h1 id="module-5-activity-5---working-with-aws-lambda"><span>Module 5: Activity 5 - Working with AWS Lambda</span></h1><p>&nbsp;
&nbsp;</p><h2 id="activity-overview"><span>Activity Overview</span></h2><p><span>In this activity, you deploy and configure an AWS Lambda-based serverless computing solution.  The Lambda function will generate a </span><em><span>Sales Analysis Report</span></em><span>, by pulling data from a database and emailing the results out on a daily basis. The database connection information is stored in the AWS Systems Manager (SSM) Parameter Store.  The database itself runs on an Amazon EC2 LAMP instance.</span></p><p><span>The diagram here shows the architecture of the Sales Analysis Report solution and illustrates the order in which actions occur.</span></p><p><img src="arch-activity-5.png" alt="architectural diagram" width="800"></p><p><span>The function steps shown in the diagram above are as follows:</span></p><ul><li><span>[1] An Amazon CloudWatch event triggers the </span><em><span>salesAnalysisReport</span></em><span> Lambda function at 8:00pm every day, Monday through Saturday.</span></li><li><span>[2] The </span><em><span>salesAnalysisReport</span></em><span> Lambda function invokes another Lambda function, </span><em><span>salesAnalysisReportDataExtractor</span></em><span>, to retrieve the report data.</span></li><li><span>[3] The </span><em><span>salesAnalysisReportDataExtractor</span></em><span> function runs an analytical query against the Mom &amp; Pop Café database (mom_pop_db).</span></li><li><span>[4] The query result is returned to the </span><em><span>salesAnalysisReport</span></em><span> function.</span></li><li><span>[5] The </span><em><span>salesAnalysisReport</span></em><span> function formats the report into a message and publishes it to the </span><em><span>salesAnalysisReportTopic</span></em><span> Amazon Simple Notification Service (SNS) topic.</span></li><li><span>[6] The </span><em><span>salesAnalysisReportTopic</span></em><span> sends the message by email to Pop.</span></li></ul><p><span>During this activity, the Python code for each Lambda function is provided to you, so that you can focus on the SysOps tasks of deploying, configuring, and testing the serverless solution components.</span></p><p>&nbsp;
&nbsp;</p><h2 id="activity-objectives"><span>Activity Objectives</span></h2><p><span>After completing this activity, you will be able to:</span></p><ul><li><strong><span>Recognize</span></strong><span> necessary IAM policy permissions to enable a Lambda function to other AWS resources.</span></li><li><strong><span>Create</span></strong><span> a Lambda layer to satisfy an external library dependency.</span></li><li><strong><span>Create</span></strong><span> a Lambda function.</span></li><li><strong><span>Deploy</span></strong><span> and test a Lambda function that is triggered based on a schedule and that invokes another function.</span></li><li><strong><span>Use</span></strong><span> CloudWatch logs to troubleshoot any issues running a Lambda function.</span></li></ul><p>&nbsp;
&nbsp;</p><h2 id="business-case-relevance"><span>Business Case Relevance</span></h2><p><strong><span>A New Business Requirement for Mom &amp; Pop Café – Daily Sales Analysis Report</span></strong></p><p><img src="../../images/icecream.png" alt="ice cream" width="300"></p><p><span>Pop is pleased that the website tracks orders placed online. Every day after closing, he now prints out the Order History page and figures out the quantity of each product sold that day.  With this information, he can project how many of each product he needs to prepare the next day to better match supply with demand.</span></p><p><span>However, he has found this manual task to be time consuming. He wished the application would perform the sales analysis automatically and send him a report by email at the end of each day. Could this enhancement be implemented?</span></p><p><span>Darsh and Sophie consulted with the Matt from the AWS Team who recommended using AWS Lambda.  It would be a cost-effective way to meet the business requirement. Take on the role of Darsh and Sophie, and deploy a Lambda-based solution to generate and distribute the sales analysis report.</span></p><p>&nbsp;
&nbsp;</p><h2 id="activity-steps"><span>Activity Steps</span></h2><p><strong><span>Duration</span></strong><span>: This activity requires approximately </span><strong><span>60 minutes</span></strong><span> to complete.</span></p><p>&nbsp;
&nbsp;</p><h2 id="accessing-the-aws-management-console"><span>Accessing the AWS Management Console</span></h2><ol start=""><li><p><span>At the top of these instructions, choose </span><span id="ssb_voc_grey"><span>Start Lab</span></span><span> to launch your lab.</span></p><p><span>A Start Lab panel opens displaying the lab status.</span></p></li><li><p><span>Wait until you see the message "</span><strong><span>Lab status: ready</span></strong><span>", then choose the </span><strong><span>X</span></strong><span> to close the Start Lab panel.</span></p></li><li><p><span>At the top of these instructions, choose </span><span id="ssb_voc_grey"><span>AWS</span></span></p><p><span>This will open the AWS Management Console in a new browser tab. The system will automatically log you in.</span></p><p><strong><span>Tip</span></strong><span>: If a new browser tab does not open, there will typically be a banner or icon at the top of your browser indicating that your browser is preventing the site from opening pop-up windows. Choose the banner or icon, and choose "Allow pop ups."</span></p></li><li><p><span>Arrange the AWS Management Console tab so that it displays along side these instructions. Ideally, you will be able to see both browser tabs at the same time, to make it easier to follow the lab steps.</span></p><p><span>Leave this browser tab open. You will return to it later in this activity.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h2 id="task-1-observe-the-iam-role-settings"><span>Task 1: Observe the IAM Role settings</span></h2><p><span>In this activity you will create two Lambda functions. Each of those functions will require permissions to access the AWS resources with which they interact.  In this task, you analyze the IAM roles and the permissions they will grant to the salesAnalysisReport and salesAnalysisReportDataExtractor Lambda functions that you will create later.</span></p><p>&nbsp;
&nbsp;</p><h3 id="task-11-observe-the-salesanalysisreport-iam-role-settings"><span>Task 1.1: Observe the salesAnalysisReport IAM Role settings</span></h3><ol start="5"><li><p><span>In the AWS Management Console select </span><strong><span>Services</span></strong><span> &gt; </span><strong><span>IAM</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Roles</span></strong><span>.</span></p></li><li><p><span>In the Roles detail page, choose the search box and type </span><code>sales</code><span>.</span></p></li><li><p><span>In the filtered results, choose the </span><strong><span>salesAnalysisReportRole</span></strong><span> hyperlink.</span></p></li><li><p><span>Choose the </span><strong><span>Trust relationships</span></strong><span> tab and notice that </span><em><span>lambda.amazonaws.com</span></em><span> is listed as a trusted entity, meaning that the Lambda service can use this role.</span></p></li><li><p><span>Choose the </span><strong><span>Permissions</span></strong><span> tab and notice the four policies attached to this role. Expand each one in turn (by choosing the triangle icon) and analyze the permissions each policy grants:</span></p><ul><li><strong><span>AmazonSNSFullAccess</span></strong><span>: provides full access to Amazon Simple Notification Service (Amazon SNS) resources.</span></li><li><strong><span>AmazonSSMReadOnlyAccess</span></strong><span>: provides read-only access to AWS Systems Manager resources.</span></li><li><strong><span>AWSLambdaBasicRunRole</span></strong><span>: provides write permissions to CloudWatch logs (required by every Lambda function).</span></li><li><strong><span>AWSLambdaRole</span></strong><span>: allows a Lambda function to invoke another Lambda function.</span></li></ul><p><span>This role will be used by the sales analysis report lambda function you will create later in this exercise.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-12-observe-the-salesanalysisreportderole-iam-role-settings"><span>Task 1.2: Observe the salesAnalysisReportDERole IAM Role settings</span></h3><ol start="11"><li><p><span>Choose </span><strong><span>Roles</span></strong><span> again, choose the search box and type </span><code>sales</code><span> again.</span></p></li><li><p><span>In the filtered results, choose the </span><strong><span>salesAnalysisReportDERole</span></strong><span> hyperlink.</span></p></li><li><p><span>Choose the </span><strong><span>Trust relationships</span></strong><span> tab and notice that lambda.amazonaws.com is listed as a trusted entity.</span></p></li><li><p><span>Choose the </span><strong><span>Permissions</span></strong><span> tab and notice the permissions granted to this role:</span></p><ul><li><strong><span>AWSLambdaBasicRunRole</span></strong><span>: provides write permissions to CloudWatch logs.</span></li><li><strong><span>AWSLambdaVPCAccessRunRole</span></strong><span>: provides permissions to manage elastic network interfaces to connect a function to a VPC.</span></li></ul><p><span>This role will be used by the salesAnalysisReportDataExtractor Lambda function you will create next.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h2 id="task-2-create-a-lambda-layer-and-a-data-extractor-lambda-function"><span>Task 2: Create a Lambda layer and a data extractor Lambda function</span></h2><p><span>In this task, you will first create a Lambda layer, and then you will create a Lambda function that uses the layer.</span></p><p><span>Start by downloading two required files.</span></p><ol start="15"><li><p><span>Download the activity files required by this task to your local machine by choosing each of the following links:</span></p><p><a href="https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/CUR-TF-200-RESOPS/activity5vocareum/pymysql-0.9.3.zip" target="_blank" rel="noopener noreferrer"><span>pymysql-0.9.3.zip</span></a></p><p><a href="https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/CUR-TF-200-RESOPS/activity5vocareum/salesAnalysisReportDataExtractor.zip" target="_blank" rel="noopener noreferrer"><span>salesAnalysisReportDataExtractor.zip</span></a></p><p><strong><span>Note</span></strong><span>: </span><em><span>salesAnalysisReportDataExtractor</span></em><span> is a Python implementation of a Lambda function that makes use of the PyMySQL open source client library to access the MySQL Mom &amp; Pop Café database.  This library has been packaged into pymysql-0.9.3.zip.  </span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-21-create-a-lambda-layer"><span>Task 2.1: Create a Lambda Layer</span></h3><p><span>In the next steps, you will create a Lambda layer named </span><em><span>pymysqlLibrary</span></em><span> and upload the client library into it so that it can be used by any function that requires it.  Lambda layers provide a flexible mechanism to reuse code between functions by eliminating the need to include the code in each function’s deployment package.</span></p><ol start="16"><li><p><span>In the AWS Management Console, select </span><strong><span>Services</span></strong><span> &gt; </span><strong><span>Lambda</span></strong><span>.</span></p></li><li><p><span>If the </span><em><span>AWS Lambda</span></em><span> panel is not displayed on the left, choose the </span><i class="fas fa-bars"></i><span>  collapsed menu icon (three horizontal lines icon)—just underneath the AWS logo—to open the panel.</span></p></li><li><p><span>Choose </span><strong><span>Layers</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Create layer</span></strong><span>.</span></p></li><li><p><span>Configure the layer settings as follows:</span></p><ul><li><strong><span>Name</span></strong><span>: </span><code>pymysqlLibrary</code><span>  </span></li><li><strong><span>Description</span></strong><span>: </span><code>PyMySQL 0.9.3 library modules</code></li><li><strong><span>Code entry type</span></strong><span>: Upload a .zip file</span></li><li><span>Choose </span><strong><span>Upload</span></strong><span>, navigate to the folder where you downloaded </span><strong><span>pymysql-0.9.3.zip</span></strong><span> and open it.</span></li><li><strong><span>Compatible runtimes</span></strong><span>: Choose </span><strong><span>Python 3.7</span></strong><span> .</span></li></ul></li><li><p><span>Choose </span><strong><span>Create</span></strong><span>.</span></p><p><span>The message </span><em><span>Successfully created layer pymysqlLibrary version 1</span></em><span> is displayed.</span></p><p><strong><span>Tip</span></strong><span>: The Lambda Layers feature requires that the ZIP file containing the code or library to reuse conform to a specific folder structure. The </span><em><span>pymysqlLibary.zip</span></em><span> file used in this activity was packaged using the following folder structure:</span></p><p><img src="../../images/layer-structure.png" alt="zipFileStructureImage" width="400"></p><p><span>For more information on Layer paths, see </span><a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html#configuration-layers-path" target="_blank" rel="noopener noreferrer"><span>here</span></a><span>.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-22-create-the-data-extractor-lambda-function"><span>Task 2.2: Create the data extractor Lambda function</span></h3><ol start="22"><li><p><span>In the “breadcrumb” navigation trail at the top, choose </span><strong><span>Lambda</span></strong><span> to open the Lambda Dashboard page.</span></p></li><li><p><span>Choose </span><strong><span>Create function</span></strong><span> and configure as follows:</span></p><ul><li><p><strong><span>Author from scratch</span></strong><span>: (selected)</span></p></li><li><p><strong><span>Function name</span></strong><span>: </span><code>salesAnalysisReportDataExtractor</code></p></li><li><p><strong><span>Runtime</span></strong><span>: Python 3.7</span></p></li><li><p><span>Expand </span><strong><span>Change default execution role</span></strong><span>, then configure the following:</span></p><ul><li><strong><span>Execution role</span></strong><span>: Use an existing role</span></li><li><strong><span>Existing role:</span></strong><span>: salesAnalysisReportDERole</span></li></ul></li></ul></li><li><p><span>Choose </span><strong><span>Create function</span></strong><span>.</span></p><p><span>A new page opens and the message </span><em><span>Successfully created the function salesAnalysisReportDataExtractor.</span></em><span> displays.  </span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-23-add-the-lambda-layer-to-the-function"><span>Task 2.3: Add the Lambda Layer to the function</span></h3><ol start="25"><li><p><span>In the </span><em><span>Function overview</span></em><span> panel, under salesAnalysisReportDataExtractor, choose </span><strong><span>Layers</span></strong><span>.</span></p></li><li><p><span>In the </span><em><span>Layers</span></em><span> panel at the bottom of the page, choose </span><strong><span>Add a layer</span></strong><span>.</span></p></li><li><p><span>In the </span><em><span>Add layer</span></em><span> page, configure as follows:</span></p><ul><li><strong><span>Choose a layer</span></strong><span>: Select the </span><em><span>Custom layers</span></em><span> card</span></li><li><strong><span>Custom layers</span></strong><span>: pymysqlLibrary</span></li><li><strong><span>Version</span></strong><span>: 1</span></li></ul></li><li><p><span>Choose </span><strong><span>Add</span></strong><span>.</span></p><p><span>The function detail page is displayed once again and the Function overview panel shows a count of (1) in the Layers node.</span></p></li></ol><p>&nbsp;</p><h3 id="task-24-import-the-data-extractor-lambda-function-code"><span>Task 2.4: Import the data extractor Lambda function code</span></h3><ol start="29"><li><p><span>Scroll down to the </span><em><span>Runtime settings</span></em><span> panel, and choose </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>In the </span><em><span>Handler</span></em><span> field, change the value to </span><code>salesAnalysisReportDataExtractor.lambda_handler</code><span>.</span></p></li><li><p><span>Choose </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Scroll back up to the </span><em><span>Code source</span></em><span> panel, and choose </span><strong><span>Upload from</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>.zip file</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Upload</span></strong><span>, then navigate to and select the </span><strong><span>salesAnalysisReportDataExtractor.zip</span></strong><span> you downloaded earlier.</span></p></li><li><p><span>Choose </span><strong><span>Save</span></strong><span>.</span></p><p><span>The Lambda function code is imported.</span></p></li><li><p><span>To view the code, double-click on the </span><strong><span>salesAnalysisReportDataExtractor.py</span></strong><span> file that now appears in the </span><em><span>Code source</span></em><span> panel.</span></p></li><li><p><span>Take a moment to review the Python code that implements the function.  </span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Read the comments included in the code to gain an understanding of its logic flow. Notice that the function expects to receive the database connection information (dbURL, dbName, dbUser and dbPassword) in the event input parameter. &nbsp;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p>&nbsp;
&nbsp;</p><h3 id="task-25-configure-network-settings-for-the-function"><span>Task 2.5: Configure network settings for the function</span></h3><p><span>The final step before you can test the function is to configure its network settings.  As shown in the architecture diagram at the start of this activity, This function requires network access to the Mom &amp; Pop Café database which runs in an EC2 LAMP instance. Therefore, you need to specify the instance’s VPC, subnet and security group information in the function’s configuration.</span></p><ol start="38"><li><p><span>Choose the </span><strong><span>Configuration</span></strong><span> tab, then choose </span><strong><span>VPC</span></strong><span>, and choose </span><strong><span>Edit</span></strong><span>. Configure the VPC settings as follows:</span></p><ul><li><p><strong><span>VPC</span></strong><span>: MomPopCafeVPC</span></p></li><li><p><strong><span>Subnets</span></strong><span>: MomPopCafe Public Subnet 1  </span></p><p><strong><span>TIP</span></strong><span>: You can ignore the warning that recommends choosing at least 2 subnets to run in high availability mode because it is not applicable to the function.</span></p></li><li><p><strong><span>Security groups</span></strong><span>: MomPopCafeSecurityGroup</span></p><p><span>Notice that the security group’s inbound and outbound rules are automatically displayed in the </span><em><span>Inbound rules</span></em><span> panel at the bottom of the screen.</span></p></li></ul></li><li><p><span>Choose </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h2 id="task-3-test-the-data-extractor-lambda-function"><span>Task 3: Test the data extractor Lambda function</span></h2><p>&nbsp;
&nbsp;</p><h3 id="task-31-launch-a-test-of-the-lambda-function"><span>Task 3.1: Launch a test of the Lambda function</span></h3><p><span>You are now ready to unit test the salesAnalysisReportDataExtractor function. In order to invoke it, you will need to supply values for the Mom &amp; Pop Café database connection parameters. Recall that these are stored in the AWS Systems Manager Parameter Store.</span></p><ol start="40"><li><p><span>In a new browser tab, open the AWS Management Console and select </span><strong><span>Services</span></strong><span> &gt; </span><strong><span>Systems Manager</span></strong><span>.</span></p></li><li><p><span>If the </span><em><span>AWS Systems Manager</span></em><span> panel is not displayed on the left, choose the </span><i class="fas fa-bars"></i><span>  collapsed menu icon (three horizontal lines icon)—just underneath the AWS logo—to open the panel.</span></p></li><li><p><span>In the </span><em><span>AWS Systems Manager</span></em><span> panel, choose </span><strong><span>Parameter Store</span></strong><span> and record the values for the following parameter names (for example, copy and paste them in a text editor document):</span></p><ul><li><span>/mompopcafe/dbUrl</span></li><li><span>/mompopcafe/dbName</span></li><li><span>/mompopcafe/dbUser</span></li><li><span>/mompopcafe/dbPassword</span></li></ul></li><li><p><span>Return to the </span><strong><span>Lambda Management Console</span></strong><span> tab, and in the salesAnalysisReportDataExtractor function details page, choose the </span><strong><span>Test</span></strong><span> tab.</span></p></li><li><p><span>Configure the </span><em><span>Test event</span></em><span> as follows:</span></p><ul><li><strong><span>New event</span></strong><span>: (selected)</span></li><li><strong><span>Template</span></strong><span>: hello-world</span></li><li><strong><span>Name</span></strong><span>: </span><code>SARDETestEvent</code></li><li><span>Replace the JSON object in the editor pane below Event name with the following:</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"dbUrl"</span>: <span class="cm-string">"&lt;value of /mompopcafe/dbUrl parameter&gt;"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"dbName"</span>: <span class="cm-string">"&lt;value of /mompopcafe/dbName parameter&gt;"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"dbUser"</span>: <span class="cm-string">"&lt;value of /mompopcafe/dbUser parameter&gt;"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"dbPassword"</span>: <span class="cm-string">"&lt;value of /mompopcafe/dbPassword parameter&gt;"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><strong><span>Important</span></strong><span>: Be sure to substitute the appropriate parameter values that you recorded in a previous step and to enclose them in double-quotes.</span></p></li><li><p><span>Choose </span><strong><span>Save changes</span></strong><span>.</span></p></li></ol><p>&nbsp;</p><ol start="46"><li><p><span>Choose </span><strong><span>Test</span></strong><span>.</span></p><p><span>After a few moments, a box displays above the </span><em><span>Test event</span></em><span> panel showing the message </span><em><span>“Execution result: failed (logs)”</span></em><span>.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3
id="task-32-troubleshooting-the-data-extractor-lambda-function"><span>Task
3.2: Troubleshooting the data extractor Lambda function</span></h3><ol
start="47"><li><p><span>In the error box, expand the
</span><strong><span>Details</span></strong><span> section. Notice the error
object returned after the function ran:</span></p><pre class="md-fences
md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json   "><div
class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json
"><div style="overflow: hidden; position: relative; width: 3px; height: 0px;
top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none"
spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em;
padding: 0px; width: 1000px; height: 1em; outline:
none;"></textarea></div><div class="CodeMirror-scrollbar-filler"
cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div
class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px;
border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
style="position: relative; top: 0px;"><div class="CodeMirror-lines"
role="presentation"><div role="presentation" style="position: relative;
outline: none;"><div
class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
class="CodeMirror-measure"></div><div style="position: relative; z-index:
1;"></div><div class="CodeMirror-code" role="presentation"><div
class="CodeMirror-activeline" style="position: relative;"><div
class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left:
0px; width: 0px;"></div><pre class=" CodeMirror-line "
role="presentation"><span role="presentation" style="padding-right:
0.1px;">{</span></pre></div><pre class=" CodeMirror-line "
role="presentation"><span role="presentation" style="padding-right: 0.1px;">
&nbsp;<span class="cm-string cm-property">"errorMessage"</span>: <span
class="cm-string">--- REDACTED ---
</span></span></pre><pre class=" CodeMirror-line "
role="presentation"><span role="presentation" style="padding-right:
0.1px;">}</span></pre></div></div></div></div></div><div style="position:
absolute; height: 0px; width: 1px; border-bottom-width: 0px;
border-bottom-style: solid; border-bottom-color: transparent; top:
88px;"></div><div class="CodeMirror-gutters" style="display: none; height:
88px;"></div></div></div></pre>
<p>
<p>&nbsp;
<span>Fix the error</span>
&nbsp;</p><h3
id="task-33-lambda-function-troubleshooting-challenge"><span>Task 3.3: Lambda
function troubleshooting challenge</span></h3><ol start="48"><li><p><span>Try
to troubleshoot and correct this issue.  </span></p>


<li><p><span>Once you
have corrected the problem, return to the salesAnalysisReportDataExtractor
Lambda function details page, and choose
</span><strong><span>Test</span></strong><span> again.</span></p><p><span>You
should now see a green box showing the message </span><em><span>“Execution
result: succeeded (logs)”</span></em><span>. This message indicates that the
function ran successfully.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-34-place-an-order-and-test-again"><span>Task 3.4: Place an order and test again</span></h3><ol start="50"><li><p><span>Expand the </span><strong><span>Details</span></strong><span> section.  </span></p><p><span>The function returned the following JSON object:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"statusCode"</span>: <span class="cm-number">200</span>, &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"body"</span>: []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>Notice that the body field, which contains the report data extracted by the function, is empty.  This is because there is no order data in the database.</span></p></li><li><p><span>In a new browser tab, access the Mom &amp; Pop Café website and place some orders to populate data in the database.</span></p><p><span>As a reminder, the URL to open the website has the format </span><a href="http://publicIP/mompopcafe" target="_blank" class="url" rel="noopener noreferrer">http://publicIP/mompopcafe</a><span>, where publicIP is the public IP address of the MomPopCafeInstance EC2 instance. You can find the public IP in the EC2 console, or you can find it by choosing </span><span id="ssb_voc_grey"><strong><span>Show</span></strong></span><span> from the </span><span id="ssb_voc_grey"><strong><span>Details</span></strong></span><span> drop down menu above these instructions.</span></p><p><span>Be sure to browse to the </span><strong><span>Menu</span></strong><span> page on the café website and submit at least one order.</span></p></li><li><p><span>Now that there is order data in the database, return to the Lambda console and test the function again. Choose </span><strong><span>Test</span></strong><span>.</span></p><p><span>Notice that the returned object now contains product quantity information in the body field, similar to the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"statusCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"body"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_group_number"</span>: <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_group_name"</span>: <span class="cm-string">"Pastries"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_id"</span>: <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_name"</span>: <span class="cm-string">"Croissant"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"quantity"</span>: <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_group_number"</span>: <span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_group_name"</span>: <span class="cm-string">"Drinks"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_id"</span>: <span class="cm-number">8</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"product_name"</span>: <span class="cm-string">"Hot Chocolate"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"quantity"</span>: <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><span>Congratulations!  You have successfully created the salesAnalysisReportDataExtractor Lambda function.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h2 id="task-4-configure-notifications"><span>Task 4: Configure notifications</span></h2><p><span>In this task, you will create a Simple Notification Service (SNS) topic and then subscribe an email address to the topic.</span></p><p>&nbsp;
&nbsp;</p><h3 id="task-41-create-a-simple-notification-service-sns-topic"><span>Task 4.1: Create a Simple Notification Service (SNS) topic</span></h3><p><span>In this task, you create the SNS topic where the Sales Analysis Report is published and subscribe Pop’s email address to it. The topic is responsible for delivering any message it receives to all of its subscribers. You perform this task using the Amazon SNS console.</span></p><ol start="53"><li><p><span>Select </span><strong><span>Services</span></strong><span> &gt; </span><strong><span>Simple Notification Service</span></strong><span>.</span></p></li><li><p><span>If the </span><em><span>Amazon SNS</span></em><span> panel is not displayed on the left, choose the </span><i class="fas fa-bars"></i><span>  collapsed menu icon (three horizontal lines icon)—just underneath the AWS logo—to open the panel.</span></p></li><li><p><span>Choose </span><strong><span>Topics</span></strong><span>, and on the right side of the screen, choose </span><strong><span>Create topic</span></strong><span>.</span></p><p><span>The </span><em><span>Create topic</span></em><span> page opens.</span></p></li><li><p><span>Configure the topic as follows:</span></p><ul><li><strong><span>Type</span></strong><span>: Standard</span></li><li><strong><span>Name</span></strong><span>: </span><code>salesAnalysisReportTopic</code></li><li><strong><span>Display name</span></strong><span>: </span><code>SARTopic</code></li></ul></li></ol><ol start="57"><li><p><span>At the bottom of the screen, choose </span><strong><span>Create topic</span></strong><span>.</span></p></li><li><p><span>Record the value of the Topic </span><em><span>ARN</span></em><span> field (for example, copy it into a text document).</span></p><p><span>You will need to specify it later when you configure the next Lambda function.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-42-subscribe-to-the-sns-topic"><span>Task 4.2: Subscribe to the SNS topic</span></h3><ol start="59"><li><p><span>Choose </span><strong><span>Create subscription</span></strong><span> and configure as shown:</span></p><ul><li><strong><span>Protocol</span></strong><span>: Email</span></li><li><strong><span>Endpoint</span></strong><span>: (type in an email address that you can access)</span></li></ul><p><strong><span>Note</span></strong><span>: For the purposes of this activity, you are going to pretend that you are Pop in order to receive the generated Sales Analysis Report.</span></p></li><li><p><span>Choose </span><strong><span>Create subscription</span></strong><span>.  </span></p><p><span>The dialog box closes and a green pop-up box appears showing the message </span><em><span>"Subscription to salesAnalysisReportTopic created successfully"</span></em><span>.</span></p></li><li><p><span>Check the inbox for the email address that you provided.</span></p><p><span>You should see an email from SARTopic with the subject AWS Notification - Subscription Confirmation.</span></p></li><li><p><span>Open the email and choose </span><strong><span>Confirm subscription</span></strong><span>.</span></p><p><span>A new browser tab should open and display a page with the message </span><em><span>"Subscription confirmed!"</span></em></p></li></ol><p>&nbsp;
&nbsp;</p><h2 id="task-5-create-the-sales-analysis-report-lambda-function"><span>Task 5: Create the sales analysis report Lambda function</span></h2><p><span>Next, you will create and configure the </span><em><span>salesAnalysisReport</span></em><span> Lambda function. This function is the main driver of the sales analysis report flow. It does the following:</span></p><ul><li><span>Retrieves the database connection information from the Systems Manager Parameter Store.</span></li><li><span>Invokes the </span><em><span>salesAnalysisReportDataExtractor</span></em><span> Lambda function which retrieves the report data from the database.</span></li><li><span>Formats and publishes a message containing the report data to the SNS topic.</span></li></ul><p><span>In this task, you will open an SSH session to the CLI Host EC2 instance running in your AWS account that already has the AWS CLI installed as well as the Python code needed to create the next Lambda function. You will then run an AWS CLI command to create the Lambda function. Finally, you will unit test the new function using the Lambda console.</span></p><p><span>Windows users should follow Task 5.1. Both macOS and Linux users should follow Task 5.2.</span></p><p><a href="#ssh-mac" target="_blank" rel="noopener noreferrer"><span>macOS/Linux users—click here for login instructions</span></a></p><p>&nbsp;
&nbsp;</p><h3 id="task-51-windows-ssh"><span>Task 5.1: Windows SSH</span></h3><p><i class="fas fa-comment"></i><span> These instructions are for Windows users only.</span></p><p><span>If you are using macOS or Linux, </span><a href="#ssh-MACLinux" target="_blank" rel="noopener noreferrer"><span>skip to the next section</span></a><span>.</span></p><ol start="63"><li><p><span>Read through the three points in this step before you start to complete the actions, because you will not be able to see these instructions when the </span><em><span>Details</span></em><span> panel is open.</span></p><ul><li><span>Choose the </span><span id="ssb_voc_grey"><span>Details</span></span><span> drop down menu above these instructions you are currently reading, and then choose </span><span id="ssb_voc_grey"><span>Show</span></span><span>. A Credentials window will open.</span></li><li><span>Choose </span><strong><span>Download PPK</span></strong><span>, and save the </span><strong><span>labsuser.ppk</span></strong><span> file. Typically, your browser will save it to the Downloads directory.</span></li><li><span>Then exit the Details panel by choosing the </span><strong><span>X</span></strong><span> icon.</span></li></ul></li><li><p><span>Download the needed software.</span></p><ul><li><span>You will use </span><strong><span>PuTTY</span></strong><span> to SSH to Amazon EC2 instances. If you do not have PuTTY installed on your computer, </span><a href="https://the.earth.li/~sgtatham/putty/latest/w64/putty.exe" target="_blank" rel="noopener noreferrer"><span>download it here</span></a><span>.</span></li></ul></li><li><p><span>Open </span><strong><span>putty.exe</span></strong><span>.</span></p></li><li><p><span>Configure PuTTY to not time out:</span></p><ul><li><span>Choose </span><strong><span>Connection</span></strong><span>.</span></li><li><span>Set </span><strong><span>Seconds between keepalives</span></strong><span> to </span><code>30</code></li></ul><p><span>This allows you to keep the PuTTY session open for a longer period of time.</span></p></li><li><p><span>Configure your PuTTY session:</span></p><ul><li><span>Choose </span><strong><span>Session</span></strong></li><li><strong><span>Host Name (or IP address):</span></strong><span> Paste the </span><em><span>Public DNS or IPv4 address</span></em><span> of the Bastion Host instance that you noted earlier. </span></li><li><span>Back in PuTTY, in the </span><strong><span>Connection</span></strong><span> list, expand </span><i class="fa fa-plus-square"></i><span> </span><strong><span>SSH</span></strong></li><li><span>Choose </span><strong><span>Auth</span></strong><span> and expand </span><i class="fa fa-plus-square"></i><span> </span><strong><span>Credentials</span></strong></li><li><span>Under </span><strong><span>Private key file for authentication:</span></strong><span> Choose </span><strong><span>Browse</span></strong></li><li><span>Browse to the </span><em><span>labsuser.ppk</span></em><span> file that you downloaded, select it, and choose </span><strong><span>Open</span></strong></li><li><span>Choose </span><strong><span>Open</span></strong><span> again</span></li></ul></li></ol><ol start="68"><li><p><span>To trust and connect to the host, choose </span><strong><span>Accept</span></strong><span>.</span></p></li><li><p><span>When prompted </span><strong><span>login as</span></strong><span>, enter: </span><code>ec2-user</code></p><p><span>This will connect you to the EC2 instance.</span></p></li><li><p><a href="#ssh-after" target="_blank" rel="noopener noreferrer"><span>Windows Users: Choose here to skip ahead to the next task.</span></a></p></li></ol><p>&nbsp;
&nbsp;</p><p><a id="ssh-MACLinux"></a></p><p>&nbsp;
&nbsp;</p><h3 id="task-52-macoslinux-ssh"><span>Task 5.2: macOS/Linux SSH</span></h3><p><span>These instructions are for Mac/Linux users only. If you are a Windows user, </span><a href="#ssh-after" target="_blank" rel="noopener noreferrer"><span>skip ahead to the next task.</span></a></p><ol start="71"><li><p><span>Read through the three points in this step before you start to complete the actions, because you will not be able to see these instructions when the </span><em><span>Details</span></em><span> panel is open.</span></p><ul><li><span>Choose the </span><span id="ssb_voc_grey"><span>Details</span></span><span> drop down menu above these instructions you are currently reading, and then select </span><span id="ssb_voc_grey"><span>Show</span></span><span>. A Credentials window will open.</span></li><li><span>Choose the </span><strong><span>Download PEM</span></strong><span> button and save the </span><strong><span>labsuser.pem</span></strong><span> file.</span></li><li><span>Then exit the Details panel by choosing the </span><strong><span>X</span></strong><span>.</span></li></ul></li><li><p><span>Open a terminal window, and change to the directory where you downloaded the labsuser.pem file.</span></p><p><span>For example, if it was saved to your Downloads directory, run the following command:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="plain"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plain"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd ~/Downloads</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre></li><li><p><span>Change the permissions on the key to be read only, by running this command:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="plain"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plain"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod 400 labsuser.pem</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre></li><li><p><span>Return to the EC2 console, and choose </span><strong><span>Instances</span></strong><span>. Check the box next to the CLI Host instance you want to connect to.</span></p></li><li><p><span>On the </span><strong><span>Details</span></strong><span> tab, copy the </span><strong><span>Public IPv4 address</span></strong><span> value.</span></p></li><li><p><span>Return to the terminal window, and run the following command (replace </span><strong><span>&lt;public-ip</span><span>&gt;</span></strong><span> with the actual public IP address you copied):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="plain"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plain"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ssh -i labsuser.pem ec2-user@&lt;public-ip&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre></li><li><p><span>When prompted to allow a first connection to this remote SSH server, enter </span><code>Yes</code></p><p><span>Because you are using a key pair for authentication, you will not be prompted for a password.</span></p></li></ol><p><a id="ssh-after"></a></p><p>&nbsp;
&nbsp;</p><h3 id="task-53-configure-the-aws-cli"><span>Task 5.3: Configure the AWS CLI</span></h3><p><strong><span>NOTE:</span></strong><span> Amazon Linux instances have the AWS CLI pre-installed, however you will still need to supply credentials to connect the AWS CLI client to an AWS account.</span></p><ol start="78"><li><p><span>Update the AWS CLI software with the credentials.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="plain"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plain"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws configure</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre></li><li><p><span>At the prompts, enter the following information:</span></p><ul><li><strong><span>AWS Access Key ID</span></strong><span>: Choose the </span><span id="ssb_voc_grey"><span>Details</span></span><span> drop down menu above these instructions, and then select </span><span id="ssb_voc_grey"><span>Show</span></span><span>. Copy the </span><strong><span>AccessKey</span></strong><span> value and paste it into the terminal window.</span></li><li><strong><span>AWS Secret Access Key</span></strong><span>: Copy and paste the </span><strong><span>SecretKey</span></strong><span> value from the same Credentials screen.</span></li><li><strong><span>Default region name</span></strong><span>: </span><code>eu-west-2</code></li><li><strong><span>Default output format</span></strong><span>: </span><code>json</code></li></ul></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-54-create-the-salesanalysisreport-lambda-function-using-the-aws-cli"><span>Task 5.4: Create the salesAnalysisReport Lambda function using the AWS CLI</span></h3><ol start="80"><li><p><span>Verify that the file containing the code for the </span><em><span>salesAnalysisReport</span></em><span> Lambda function is already on the CLI Host by running the following commands:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd activity-files</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ls</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre></li><li><p><span>Before you create the function, retrieve the ARN of the </span><em><span>salesAnalysisReportRole</span></em><span> IAM role. You will need to specify it in the next step.</span></p><p><strong><span>Tip</span></strong><span>: To find the ARN of an IAM role, open the IAM console, choose </span><strong><span>Roles</span></strong><span>, and select the role name. The Role ARN appears on the </span><em><span>Summary</span></em><span> page.</span></p></li><li><p><span>Use the AWS Lambda </span><em><span>create-function</span></em><span> command to create the Lambda function and configure it to use the salesAnalysisReportRole IAM role.</span></p><p><span>To do this, at the command prompt, paste in the following command. Replace </span><strong><span>&lt;salesAnalysisReportRoleARN</span><span>&gt;</span></strong><span> with the actual value of the salesAnalysisReportRole ARN, which you copied a moment ago and replace </span><strong><span>&lt;region</span><span>&gt;</span></strong><span> with the region where you created the previous lambda function. You can find the region in the Lambda console.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="plain"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plain"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws lambda create-function \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--function-name salesAnalysisReport \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--runtime python3.7 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zip-file fileb://salesAnalysisReport.zip \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--handler salesAnalysisReport.lambda_handler \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region &lt;region&gt; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--role &lt;salesAnalysisReportRoleARN&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>Once the command completes, it returns a JSON object describing the attributes of the function. You can now proceed to complete its configuration and unit test it.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-55-configure-the-salesanalysisreport-lambda-function"><span>Task 5.5: Configure the salesAnalysisReport Lambda function</span></h3><ol start="83"><li><p><span>Open the Lambda console.</span></p></li><li><p><span>Choose </span><strong><span>Functions</span></strong><span>, and then choose the </span><strong><span>salesAnalysisReport</span></strong><span> hyperlink.</span></p><p><span>The detail page for the function is opened.</span></p></li><li><p><span>Take a moment to review the details of the created function.</span></p><p><span>In particular, on the </span><strong><span>Code</span></strong><span> tab, read through the function code and use the embedded comments to help you understand the logic.</span></p><p><span>Notice on </span><em><span>line 26</span></em><span> that the function retrieves the ARN of the topic to publish to from an environment variable named </span><em><span>topicARN</span></em><span>.  Therefore, you will need to define that environment variable..</span></p></li><li><p><span>Choose the </span><strong><span>Configuration</span></strong><span> tab, and on the left side, choose </span><strong><span>Environment variables</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Edit</span></strong><span>, and then choose </span><strong><span>Add environment variable</span></strong><span>. Configure a new variable as follows:</span></p><ul><li><strong><span>Key</span></strong><span>: </span><code>topicARN</code></li><li><strong><span>Value</span></strong><span>: (paste in the ARN value of the salesAnalysisReportTopic you copied earlier)</span></li></ul></li><li><p><span>Choose </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-56-test-the-salesanalysisreport-lambda-function"><span>Task 5.6: Test the salesAnalysisReport Lambda function</span></h3><p><span>You are now ready to test the function.</span></p><ol start="89"><li><p><span>Choose the </span><strong><span>Test</span></strong><span> tab.</span></p><p><span>The Configure test event dialog box opens.</span></p></li><li><p><span>Configure as follows:</span></p><ul><li><strong><span>New event</span></strong><span>: (selected)</span></li><li><strong><span>Template</span></strong><span>: hello-world</span></li><li><strong><span>Name</span></strong><span>: </span><code>SARTestEvent</code></li></ul><p><span>The function does not require any input parameters (just leave the default JSON lines there).</span></p></li><li><p><span>Choose </span><strong><span>Save changes</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Test</span></strong><span>.</span></p><p><span>You should soon see a green box showing the message </span><em><span>“Execution result: succeeded (logs)”</span></em><span>.</span></p><p><strong><span>Tip:</span></strong><span> If you get a </span><em><span>time out</span></em><span> error, choose </span><strong><span>Test</span></strong><span> again. Sometimes, when you first run a function, it takes a little longer to initialize, and the Lambda default timeout value (3 seconds) is exceeded. Usually, you can run it again, and the error will go away. Alternatively, increase the timeout value in the </span><strong><span>Configuration</span></strong><span> tab in the </span><em><span>General configuration</span></em><span> panel.</span></p></li><li><p><span>Expand the </span><strong><span>Details</span></strong><span> section.</span></p><p><span>The function should have returned the following JSON object:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"statusCode"</span>: <span class="cm-number">200</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"body"</span>: <span class="cm-string">"\"Sale Analysis Report sent.\""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre></li><li><p><span>Check your email inbox.</span></p><p><span>If there were no errors, you should receive an email from </span><em><a href="mailto:no-reply@sns.amazonaws.com" target="_blank" class="url" rel="noopener noreferrer">no-reply@sns.amazonaws.com</a></em><span> with the subject </span><em><span>Daily Sales Analysis Report</span></em><span>.  </span></p><p><span>The email should contain a report that is similar to the one shown here, depending on the orders you placed on the website:</span></p><p><img src="../../images/emailed-report.png" alt="emailed report screenshot" width="400"></p></li><li><p><span>Feel free to place more orders on the Mom &amp; Pop Café website and test the function to see the changes in the report that you receive.</span></p><p><span>Great job! You have successfully unit tested the salesAnalysisReport Lambda function.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="task-57-add-a-trigger-to-the-salesanalysisreport-lambda-function"><span>Task 5.7: Add a trigger to the salesAnalysisReport Lambda function</span></h3><p><span>To complete the implementation of the </span><em><span>salesAnalysisReport</span></em><span> function, configure the report to be invoked every day, Monday through Saturday, at 8:00pm. To do so, you will use an EventBridge (CloudWatch event) as the invocation mechanism.</span></p><ol start="96"><li><p><span>In the </span><em><span>Function overview</span></em><span> panel at the top of the salesAnalystReport function details page, choose </span><strong><span>Add trigger</span></strong><span>.</span></p></li><li><p><span>In the </span><em><span>Add trigger</span></em><span> panel, select </span><strong><span>EventBridge (CloudWatch Events)</span></strong><span> and configure:</span></p><ul><li><p><strong><span>Rule</span></strong><span>: Create a new rule</span></p></li><li><p><strong><span>Rule name</span></strong><span>: </span><code>salesAnalysisReportDailyTrigger</code></p></li><li><p><strong><span>Rule description</span></strong><span>: </span><code>Triggers report generation on a daily basis</code></p></li><li><p><strong><span>Rule type</span></strong><span>: Schedule expression</span></p></li><li><p><strong><span>Schedule expression</span></strong><span>: specify the schedule that you desire using a Cron expression.</span></p><p><span>The general syntax of a Cron expression requires six fields separated by white space as follows:</span></p><p><span>  cron(Minutes Hours Day-of-month Month Day-of-week Year)</span></p><p><span>In addition, all times in a Cron expression are based on the UTC time zone.</span></p><p><span>For testing purposes, type an expression that schedules the trigger 5 minutes from the current time. For example:</span></p><ul><li><p><span>If you are in </span><strong><span>London</span></strong><span> (UTC time zone), and the current time is 11:30am, type the following expression:</span></p><p><code>cron(35 11 ? * MON-SAT *)</code></p></li><li><p><span>If you are in </span><strong><span>New York</span></strong><span> (UTC time zone - 5), and the current time is 11:30am, type the following expression:</span></p><p><code>cron(35 16 ? * MON-SAT *)</code></p></li></ul><p><span>  This schedules the event to be triggered at 11:35am every day, Monday through Saturday.</span></p><p><span>  </span><strong><span>Tip</span></strong><span>: For more information on the syntax of schedule expressions for rules, see </span><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html" target="_blank" rel="noopener noreferrer"></a><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html" target="_blank" class="url" rel="noopener noreferrer">https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html</a><span>.</span></p></li><li><p><span>Choose </span><strong><span>Add</span></strong><span>.</span></p></li></ul><p><span>The new trigger is created and displayed on the </span><strong><span>Configuration</span></strong><span> tab in the </span><em><span>Triggers</span></em><span> panel.</span></p></li><li><p><strong><span>Challenge question</span></strong><span>:</span></p><p><span>What should the Cron expression be when you deploy the function in production?</span></p><p><span>Remember that you need to schedule the trigger every day, Monday through Saturday. Assume that you are in the UTC time zone.</span></p></li><li><p><span>Wait until 5 minutes have elapsed, and then check your email inbox.</span></p><p><span>If there were no errors, you should see a new email from AWS Notifications with a subject of Daily Sales Analysis Report.  This one was triggered by the CloudWatch event at the time that you specified in the Cron expression.</span></p></li></ol><p>&nbsp;
&nbsp;</p><h3 id="update-from-mom--pop-café"><span>Update from Mom &amp; Pop Café</span></h3><p><img src="../../images/image001.jpg" alt="café scene"></p><p><span>Darsh and Sophie arrived at the café the next morning after deploying the Lambda serverless solution. As soon as Pop saw them walk in the door, he excitedly pulled out his cell phone and showed them the email he had received with the order details in it.</span></p><p><span>He explained how helpful this new reporting capability is. Now he won't have to log in every day to check the orders database details and manually calculate the orders placed. Instead, he just checks his email and he already knows how much of each item he will need to prepare.</span></p><p><span>Secretly, Pop hopes that recruiters for competing companies don't find out about Darsh and Sophie's cutting edge technical skills and offer them higher paying jobs! He is sure they will be able to create even more helpful business enhancements to the Mom and Pop Café cloud deployment in the future, if only he can get them to stay. Maybe he should offer them a raise or at least some free dessert! He is thrilled about what they have accomplished.</span></p><p>&nbsp;
&nbsp;</p><h2 id="activity-complete"><span>Activity Complete</span></h2><p><i class="icon-flag-checkered"></i><span> Congratulations! You have completed the activity.</span></p><ol start="100"><li><span>Choose </span><span id="ssb_voc_grey"><span>End Lab</span></span><span> at the top of this page, and then choose </span><span id="ssb_blue"><span>Yes</span></span><span> to confirm that you want to end the activity.  </span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A panel will appear, indicating that "DELETE has been initiated... You may close this message box now."</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><ol start="101"><li><span>Choose the </span><strong><span>X</span></strong><span> in the top right corner to close the panel.</span></li></ol><p><em><span>©2021 Amazon Web Services, Inc. and its affiliates. All rights reserved. This work may not be reproduced or redistributed, in whole or in part, without prior written permission from Amazon Web Services, Inc. Commercial copying, lending, or selling is prohibited.</span></em></p></div>

</body>
</html>
